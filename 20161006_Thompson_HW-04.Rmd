---
title: "Homework 4 - GVPT 729A"
author: "Nick Thompson"
date: "10/2/2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(foreign)
library(stargazer)
library(knitr)
library(gmodels)
library(dplyr)
library(ggplot2)
library("devtools")
rm(list=ls())
cat("\014")
```

Answer the following questions. Include your code, and report all the re- sults you used to answer the questions. https://raw.githubusercontent.com/Neilblund/729A/master/data/voterid.csv

```{r data, include=TRUE}
setwd("~/Documents/GitHubRepo/729_Reed_MLE_git/Assignments")
#voterid <- read.csv(file = "https://raw.githubusercontent.com/Neilblund/729A/master/data/voterid.csv", header = TRUE, sep = ",")
#save(voterid2, file = "voterid2.RData")
load("voterid.RData")
#View(voterid2)
```

The link above contains data from ``Hicks et al. 2015:  A Principle or a Strategy?  Voter Identification Laws and Partisan Competition in the American States''

* `photo` is equal to $1$ if a state has legislation that requires voters to show photo ID at the polling booth, and $0$ if they do not have to have this requirement.

* `fraud` is the average number of voter fraud cases prosecuted in a given state since 2001.

* `election_margin` is the average partisan vote margin ($\%$ Republican - $\%$ Democratic) in a state since 2001.

* `gopleg` is the average $\%$ of a state's legislature that is Republican.

# Questions

1. Run a probit regression using photo as the dependent variable, and fraud, election margin and gopleg as independent variables. Obtain predicted probabilities that photo = 1 at two different values of one of your independent variables using the observed values approach.

```{r probit, include=TRUE}
#descriptive statistics for all variables
#stargazer(voterid, type = 'text')
# run probit, show results
voterid2 <- na.omit(voterid)
#View(voterid2)
stargazer(voterid2, type = 'text')
voterid2$mean_gopleg <- mean(voterid2$gopleg)
voterid2$sd_gopleg <- sd(voterid2$gopleg)

# run probit, show results
(model_1 <- glm('photo ~ fraud + election_margin + gopleg', 
               family = binomial(link = "probit"), 
               data = voterid2)) 

summary(model_1)
#stargazer(model_1,type = 'text')

# generate predicted probabilities automatically
voterid2$pprob <- predict(model_1,type="response")

# generate predicted probabilities manually
voterid2$pprob_manual <- pnorm(model_1$coef['(Intercept)'] +
                                 model_1$coef['fraud']*voterid2$fraud +
                                 model_1$coef['election_margin']*voterid2$election_margin +
                                 model_1$coef['gopleg']*voterid2$gopleg)

# test that we did it right
voterid2$pprob_test <- voterid2$pprob - voterid2$pprob_manual
summary(voterid2$pprob_test) # should be zeros

#######1. calculate average effect of photo using observed values----
voterid2$pprob_gopleg_upsd <- pnorm(model_1$coef['(Intercept)'] + 
                                 model_1$coef['fraud']*voterid2$fraud + 
                                 model_1$coef['election_margin']*voterid2$election_margin + 
                                 model_1$coef['gopleg']*(voterid2$mean_gopleg+voterid2$sd_gopleg))
summary(voterid2$pprob_gopleg_upsd)

voterid2$pprob_gopleg_downsd <- pnorm(model_1$coef['(Intercept)'] + 
                                 model_1$coef['fraud']*voterid2$fraud + 
                                 model_1$coef['election_margin']*voterid2$election_margin + 
                                 model_1$coef['gopleg']*(voterid2$mean_gopleg-voterid2$sd_gopleg))
summary(voterid2$pprob_gopleg_downsd)

voterid2$pprob_effect <- voterid2$pprob_gopleg_upsd - voterid2$pprob_gopleg_downsd
summary(voterid2$pprob_effect)		

```

**The probability that `photo` $=1$ when `gopleg` is $1$ standard deviation above its mean is `r mean(voterid2$pprob_gopleg_upsd)`, and the probability that `photo` $=1$ when `gopleg` is $1$ standard deviation below its mean is `r mean(voterid2$pprob_gopleg_downsd)`  The difference between the two is `r mean(voterid2$pprob_effect)`.**

2.  Use the “for loops” code to simulate ten draws from a set of random coefficients (see note 1). Calculate the mean difference between the two hypothetical scenarios, and report the 96% confidence interval around your results.

```{r loops - 01, include = TRUE}

```

3.  Use the “obsval” command to create 1000 simulated coefficients. Report the average effect and the 95% confidence interval around your results. (see note 2)

# notes

1.  The obsval-demo.R script contains a worked example of doing this using the Hanmer and Kalkan data. The code section labeled “2. Iterative for loops (ie, slow way)” has instructions. Keep in mind that you will need to install and load the mvtnorm package to make this work.

2.  This will require you to install the obsval package and its dependencies. An example of using the obsval function is in the code section labeled “4. FUNCTIONAL WAY” in the obsval-demo.R script.

3.  If you’re not familiar with loops in R you might be struggling to read some of the code provided. Take a look at this R-bloggers post for a simple explanation of how loops work.

